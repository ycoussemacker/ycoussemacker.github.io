<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Land&Globe</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="" name="keywords">
  <meta content="" name="description">

  <!-- Favicons -->
  <link href="img/téléchargement.png" rel="icon">
  <link href="img/téléchargement.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900" rel="stylesheet">

  <!-- Bootstrap CSS File -->
  <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Libraries CSS Files -->
  <link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">

  <!-- Main Stylesheet File -->
  <link href="css/style.css" rel="stylesheet">

  <!-- =======================================================
    Template Name: Soon
    Template URL: https://templatemag.com/soon-website-under-construction-template/
    Author: TemplateMag.com
    License: https://templatemag.com/license/
  ======================================================= -->
</head>


<script type="text/javascript">
  // var mydata = require("./km.json");

  var requestURL = 'https://ycoussemacker.github.io/km.json'

  var request = new XMLHttpRequest();

  var km = 0;

  var i = 0 ;

  function read_json(){   
    request.open('GET', requestURL);
    request.responseType = 'json';
    request.send();
    request.onload = function() {
      km = request.response.km;
      console.log(km);
      document.getElementById('nb').innerHTML = km; 

      // progression de la barre
      if(i==0){
        i = 1;
        var elem = document.getElementById("myBar");

        let percentage_max = 100;
        if(km<40075){
          percentage_max = (km/40075)*100;
        } 
        // console.log(percentage_max)
        
        var nb_step = 30

        let step = percentage_max / nb_step;
        var width = 0;

        var id = setInterval(frame, nb_step);      
        // console.log(width)
        function frame() {
          if (width >= percentage_max) {
            // clearInterval(id);
            i = 0;
          } else {
            width += step;
            elem.style.width = width.toString() + "%";
            console.log(width)
            
          }
        }
      }
      
    }
  }

  function write_json(){
    var to_add = parseInt(document.getElementById('km').value);
    km = km + to_add;
    console.log("Write : " + km);
    var data = {"km" : km};
    var jsonData = JSON.stringify(data);

    //écriture sur le json
    var a = document.createElement("a");
    var file = new Blob([jsonData], {type: 'text/plain'});
    a.href = URL.createObjectURL(file);
    a.replaceWith= requestURL;
    a.click();
    URL.revokeObjectURL(a.href)
    read_json();

    // request.open('SET', requestURL);
    // request.send();
    // request.onload = function() {
    //   request.response.km = km + to_add;
    // }
    // read_json();
  }

  var i = 0;
  function move() {
    if (i == 0) {
      i = 1;
      var elem = document.getElementById("myBar");

      let percentage_max = (km*100/40075);
      console.log(percentage_max)

      let step = percentage_max / 10;
      var width = 0;

      // var id = setInterval(frame, 10);      
      // console.log(width)
      function frame() {
        if (width >= percentage_max) {
          clearInterval(id);
          i = 0;
        } else {
          width += step;
          elem.style.width = step.toString() + "%";
          console.log(width)
          
        }
      }
    }
  }
</script>


<body onload="read_json()">

  <div id="h">
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-md-offset-3">
          <div class="screen">
            <h2 style="font-weight: 600;">Land&Globe</h2>
            <div class="name">
              <img src="img/Bloc_Virades_Espoir-Horizontal-Blanc-01.png" class="aligncenter" width="50%">
            </div>
            <h5>
              Au vu du contexte actuel, il nous est difficile d’utiliser le ballon ovale mais nos jambes sont toujours de la partie ! <br/>
              Pour soutenir la lutte contre la <b style="color:#0b8674">mucoviscidose</b> nous lançons un challenge : l’équipe féminine de l’Avenir Aturin vous propose, en collaboration avec les <b style="color:#0b8674">Virades de l’Espoir</b>, de faire un <b>tour du monde</b> avant la journée nationale du <i style="font-size: 20px;">26 septembre 2021</i>. <br/>
              <br/>Comment ?
              <br/>Avec une <b>paire de basket</b> et un peu de <b>motivation</b>! <br/>
              Alors, prêt à relever le défi ?
            </h5>
            <hr/>
            <div class="countdown-header">
              <h3>Je contribue à la cause</h3>            
              <p>Déjà <b id='nb'>0</b> km parcourus !! </p> 
              <div id="myProgress">
                <div id="myBar"></div>
              </div>
              <input type="number" id="km" name="km" min="1" max="50" placeholder="1">
              <input type="button" onclick="write_json()" value="Ajouter mes kilomètres" /> 
            </div>
          </div>
        </div>
      </div>
      <!--/row-->
    </div>
    <!--/container-->
  </div>
  <!--/H-->

  <!-- JavaScript Libraries -->
  <script src="lib/jquery/jquery.min.js"></script>
  <script src="lib/bootstrap/js/bootstrap.min.js"></script>
  <script src="lib/php-mail-form/validate.js"></script>
  <script src="lib/countdown/jquery.plugin.min.js"></script>
  <script src="lib/countdown/jquery.countdown.min.js"></script>

  <!-- Template Main Javascript File -->
  <script src="js/main.js"></script>

</body>
</html>
